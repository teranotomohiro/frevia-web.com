<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TikTokアルゴリズムの仕組みとAI投稿アシスト。freviaが提供するマーケティング自走支援ツール。">
    <title>TikTok Algorithm Master Guide | 株式会社frevia</title>
    <link rel="stylesheet" href="frevia-tiktok.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <a href="#main-content" class="skip-link">メインコンテンツへスキップ</a>

    <div class="l-app-container">
        <aside class="l-sidebar" id="sidebar-nav">
            <div class="l-sidebar__inner">
                <div class="c-logo-area">
                    <p class="c-logo">TikTok<br><span class="u-text-primary">Algorithm</span><br><span class="c-logo__sub">Master Guide</span></p>
                </div>
                <nav class="p-nav" aria-label="メインメニュー">
                    <ul class="p-nav__list">
                        <li><a href="#" class="p-nav__link active" data-section="section-overview">概要</a></li>
                        <li><a href="#" class="p-nav__link" data-section="section-ladder">拡散の仕組み</a></li>
                        <li><a href="#" class="p-nav__link" data-section="section-metrics">重要指標</a></li>
                        <li><a href="#" class="p-nav__link" data-section="section-simulator">投稿診断</a></li>
                        <li><a href="#" class="p-nav__link p-nav__link--featured" data-section="section-ai-lab">✨ AI投稿アシスト</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <main id="main-content" class="l-main">
            <header class="l-mobile-header">
                <span class="c-logo">TikTok <span class="u-text-primary">Algorithm</span></span>
                <button type="button" class="c-hamburger" id="js-hamburger" aria-expanded="false" aria-label="メニューを開く">
                    <span class="c-hamburger__line"></span>
                    <span class="c-hamburger__line"></span>
                    <span class="c-hamburger__line"></span>
                </button>
            </header>

            <div class="l-content-inner">
                <section id="section-overview" class="p-section active">
                    <header class="p-section__header">
                        <h2 class="c-heading">TikTokアルゴリズムの正体</h2>
                        <p class="c-lead-text">「誰が」ではなく「何が」面白いかをAIが判断する、実力主義の世界。</p>
                    </header>
                    <div class="p-grid">
                        <article class="c-card">
                            <h3 class="c-card__title">ソーシャルグラフ</h3>
                            <p class="u-text-sub">既存のSNS (FB/IG/X)</p>
                            <p>フォロワーとの繋がりが重要。新規アカウントは埋もれやすい構造です。</p>
                        </article>
                        <article class="c-card c-card--highlight">
                            <h3 class="c-card__title">インタレストグラフ</h3>
                            <p class="u-text-sub">TikTok</p>
                            <p>個人の興味関心が最優先。フォロワー0でも100万再生が可能なアルゴリズムです。</p>
                        </article>
                    </div>
                </section>

                <section id="section-ladder" class="p-section">
                    <h2 class="c-heading">拡散の仕組み</h2>
                    <div class="c-card">
                        <p>動画は段階的に評価され、各ステップ（ラダー）を突破することで拡散規模が拡大します。</p>
                        <div id="ladder-chart-container" style="height: 300px; margin-top: 2rem;">
                            <canvas id="ladderChart"></canvas>
                        </div>
                    </div>
                </section>

                <section id="section-metrics" class="p-section">
                    <h2 class="c-heading">重要指標</h2>
                    <div class="p-grid">
                        <div class="c-card">
                            <h3 class="c-card__title">評価ウェイト</h3>
                            <canvas id="metricsChart"></canvas>
                        </div>
                        <div class="c-card">
                            <h3 class="c-card__title">視聴維持率モデル</h3>
                            <canvas id="retentionChart"></canvas>
                        </div>
                    </div>
                </section>

                <section id="section-simulator" class="p-section">
                    <h2 class="c-heading">投稿バズ度診断</h2>
                    <div class="p-simulator c-card">
                        <div class="p-simulator__form">
                            <div class="c-form-group">
                                <label class="p-form__label">平均視聴維持率: <span id="val-retention" class="u-text-primary">30%</span></label>
                                <input type="range" id="input-retention" class="c-range" min="0" max="100" value="30">
                            </div>
                            <div class="c-form-group">
                                <label class="p-form__label">フル視聴率: <span id="val-completion" class="u-text-primary">15%</span></label>
                                <input type="range" id="input-completion" class="c-range" min="0" max="100" value="15">
                            </div>
                            <button type="button" id="btn-analyze-stats" class="c-btn c-btn--primary c-btn--wide">✨ AIに分析を依頼</button>
                        </div>
                        <div class="p-simulator__result">
                            <p class="u-text-center">推定評価ランク</p>
                            <div id="result-tier" class="u-text-rank">C</div>
                            <div class="c-progress" aria-hidden="true"><div id="score-bar" class="c-progress__bar"></div></div>
                        </div>
                    </div>
                    <div id="ai-stats-result" class="c-card u-mt-lg hidden">
                        <p id="ai-stats-text" style="white-space: pre-wrap; font-size: 0.9rem; color: var(--color-corporate-blue);"></p>
                    </div>
                </section>

                <section id="section-ai-lab" class="p-section">
                    <h2 class="c-heading">AI 投稿アシスト</h2>
                    <div class="c-card">
                        <div class="p-ai-input-group">
                            <input type="text" id="ai-input-topic" class="c-input" placeholder="ジャンルを入力（例：時短レシピ）">
                            <button type="button" id="btn-generate-concept" class="c-btn c-btn--accent">企画を生成</button>
                        </div>
                        <div id="ai-concepts-container" class="p-grid u-mt-lg"></div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const apiKey = ""; // ランタイムより供給
            
            // --- ナビゲーション制御 ---
            const navLinks = document.querySelectorAll('.p-nav__link');
            const sections = document.querySelectorAll('.p-section');
            const hamburger = document.getElementById('js-hamburger');
            const sidebar = document.getElementById('sidebar-nav');

            function switchSection(id) {
                sections.forEach(s => s.classList.remove('active'));
                navLinks.forEach(l => l.classList.remove('active'));
                
                const target = document.getElementById(id);
                if(target) target.classList.add('active');
                
                const activeLink = document.querySelector(`[data-section="${id}"]`);
                if(activeLink) activeLink.classList.add('active');
                
                // モバイル時はメニューを閉じる
                sidebar.classList.remove('is-open');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchSection(link.dataset.section);
                });
            });

            // --- モバイルメニュー制御 ---
            hamburger.addEventListener('click', () => {
                const isOpen = sidebar.classList.toggle('is-open');
                hamburger.setAttribute('aria-expanded', isOpen);
            });

            // --- シミュレーター計算 ---
            const inputs = ['input-retention', 'input-completion'];
            function updateSim() {
                const ret = document.getElementById('input-retention').value;
                const comp = document.getElementById('input-completion').value;
                document.getElementById('val-retention').innerText = ret + '%';
                document.getElementById('val-completion').innerText = comp + '%';

                const score = (ret * 0.6) + (comp * 0.4);
                let tier = 'C';
                if(score > 70) tier = 'S';
                else if(score > 50) tier = 'A';
                else if(score > 30) tier = 'B';
                
                document.getElementById('result-tier').innerText = tier;
                document.getElementById('score-bar').style.width = score + '%';
            }
            inputs.forEach(id => document.getElementById(id).addEventListener('input', updateSim));
            updateSim();

            // --- チャート初期化 (Chart.js) ---
            new Chart(document.getElementById('metricsChart'), {
                type: 'doughnut',
                data: {
                    labels: ['視聴時間', '完了率', '反応'],
                    datasets: [{
                        data: [50, 30, 20],
                        backgroundColor: ['#23a5bb', '#003668', '#e84233']
                    }]
                }
            });

            // --- AI機能 (Gemini API 連携用プレースホルダー) ---
            async function callGemini(prompt) {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "You are a world-class TikTok Expert. Answer in Japanese." }] }
                    })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "AI通信に失敗しました。";
            }

            document.getElementById('btn-generate-concept').addEventListener('click', async () => {
                const topic = document.getElementById('ai-input-topic').value;
                if(!topic) return;
                const container = document.getElementById('ai-concepts-container');
                container.innerHTML = '<p class="u-text-center">分析中...</p>';
                const result = await callGemini(`${topic}に関するバズるTikTok動画企画を2つ提案してください。タイトルとフックを明確に。`);
                container.innerHTML = `<div class="c-card"><p style="white-space:pre-wrap">${result}</p></div>`;
            });
        });
    </script>
</body>
</html>